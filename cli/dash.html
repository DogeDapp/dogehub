<!DOCTYPE html>
<html>
<head>
	<title>PointHub</title>
	<style type="text/css">
		body {
			position: fixed;
			height: 100%;
			width: 100%;
		}
		.dawg {
			position: fixed;
			width: 12px;
			height: 19px;
			background-image: url(http://g-ecx.images-amazon.com/images/G/01/mas/retail/images/cursor._V172774602_.png);
		}
	</style>
</head>
<body>
	<script src="//code.jquery.com/jquery-latest.min.js"></script>
	<script>

		if(typeof(Storage) == "undefined") {
			console.warn("localStorage not supported");
			var pid = Math.floor(Math.random() * 1000);
		} else {
			var pid = localStorage.pid || Math.floor(Math.random() * 1000);
			localStorage.pid = pid;
		}
		console.log("pid: " . pid);
		


		var host = location.origin.replace(/^http/, 'ws'),
			ws = new WebSocket(host),
			dawgs = {};

		ws.onmessage = function (data) {
			dawgs = JSON.parse(data.data);
			console.log(dawgs);
			$.each(dawgs, function(index, dawg) {
				if (index == pid)
					return 1;
				var d = $(".dawg-" + index);
				if (!!d.length) {
					$(d[0]).css({
						top: dawg.y + "px",
						left: dawg.x + "px"
					});
				} else {
					$("body").append("<div class='dawg dawg-" +
						index+
						"'></div>");
				}
			});
		}


		$("body").on("mousemove", function(e) {
			ws.send(JSON.stringify({
				id: pid,
				mx: e.pageX,
				my: e.pageY
			}));
		});

	</script>
</body>
</html>
